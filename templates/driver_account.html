{% extends "base.html" %}
{% block title %}كشف حساب {{ driver.full_name }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>كشف حساب السائق: {{ driver.full_name }}</h2>
    <p class="text-muted">رقم الرخصة: {{ driver.license_number }} | الراتب الشهري: {{ driver.salary }}</p>
    <hr>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card text-white bg-{% if balance >= 0 %}success{% else %}danger{% endif %}">
                <div class="card-header">الرصيد الحالي</div>
                <div class="card-body">
                    <h4 class="card-title">{{ balance | round(2) }}</h4>
                    <p class="card-text">{% if balance >= 0 %}دائن (للسائق){% else %}مدين (على السائق){% endif %}</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 d-flex align-items-center justify-content-end">
            <a href="{{ url_for('add_driver_transaction', driver_id=driver.id) }}" class="btn btn-warning me-2">
                <i class="bi bi-cash-stack"></i> إضافة سلفة/مكافأة
            </a>
            <a href="#" class="btn btn-info" onclick="window.print()">
                <i class="bi bi-printer"></i> طباعة الكشف
            </a>
        </div>
    </div>
    
    <h3>سجل المعاملات</h3>
    {% if transactions %}
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>التاريخ</th>
                <th>النوع</th>
                <th>المبلغ</th>
                <th>الوصف</th>
                <th>الرصيد بعد المعاملة</th>
            </tr>
        </thead>
        <tbody>
            {% set current_balance = 0 %}
            {% for transaction in transactions | reverse %}
                {% if transaction.type == 'CREDIT' %}
                    {% set current_balance = current_balance + transaction.amount %}
                {% elif transaction.type == 'DEBIT' %}
                    {% set current_balance = current_balance - transaction.amount %}
                {% endif %}
            <tr>
                <td>{{ transaction.date }}</td>
                <td>
                    {% if transaction.type == 'CREDIT' %}
                        <span class="badge bg-success">دائن (للسائق)</span>
                    {% else %}
                        <span class="badge bg-danger">مدين (على السائق)</span>
                    {% endif %}
                </td>
                <td>{{ transaction.amount | round(2) }}</td>
                <td>{{ transaction.description }}</td>
                <td>{{ current_balance | round(2) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="alert alert-warning">لا توجد معاملات مسجلة لهذا السائق.</div>
    {% endif %}
</div>
{% endblock %}
